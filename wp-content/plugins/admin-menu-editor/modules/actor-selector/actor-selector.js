"use strict";var AmeActorSelector=function(){function e(t,i,s,o,r){var n=this;this.selectedActor=null,this.visibleUsers=[],this.subscribers=[],this.isProVersion=!1,this.cachedVisibleActors=null,this.actorManager=t,"undefined"!=typeof s?this.currentUserLogin=s:this.currentUserLogin=wsAmeActorSelectorData.currentUserLogin,"undefined"!=typeof o?this.visibleUsers=o:this.visibleUsers=wsAmeActorSelectorData.visibleUsers,"undefined"!=typeof i&&(this.isProVersion=i),r?this.ajaxParams=r:this.ajaxParams=wsAmeActorSelectorData;var l=e._;this.visibleUsers=l.intersection(this.visibleUsers,l.keys(t.getUsers())),jQuery.isReady?this.initDOM():jQuery(function(){n.initDOM()})}return e.prototype.initDOM=function(){var e=this;return this.selectorNode=jQuery("#ws_actor_selector"),this.populateActorSelector(),this.isProVersion?(this.selectorNode.on("click","li a.ws_actor_option",function(t){var i=jQuery(t.target).attr("href").substring(1);""===i&&(i=null),e.setSelectedActor(i),t.preventDefault()}),void this.selectorNode.on("click","#ws_show_more_users",function(t){t.preventDefault(),AmeVisibleUserDialog.open({currentUserLogin:e.currentUserLogin,users:e.actorManager.getUsers(),visibleUsers:e.visibleUsers,save:function(t,i){e.actorManager.addUsers(t),e.visibleUsers=i,e.cachedVisibleActors=null,e.populateActorSelector(),e.saveVisibleUsers()}})})):void this.selectorNode.hide()},e.prototype.setSelectedActor=function(e){if(null===e||this.actorManager.actorExists(e)){var t=this.selectedActor;if(this.selectedActor=e,this.highlightSelectedActor(),this.selectedActor!==t)for(var i=0;i<this.subscribers.length;i++)this.subscribers[i](this.selectedActor,t)}},e.prototype.onChange=function(e){this.subscribers.push(e)},e.prototype.highlightSelectedActor=function(){this.selectorNode.find(".current").removeClass("current");var e;e=null===this.selectedActor?"a.ws_no_actor":'a[href$="#'+this.selectedActor+'"]',this.selectorNode.find(e).addClass("current")},e.prototype.populateActorSelector=function(){var e=this.selectorNode,t=jQuery,i=!1;e.empty(),e.append('<li><a href="#" class="current ws_actor_option ws_no_actor" data-text="All">All</a></li>');for(var s=this.getVisibleActors(),o=0;o<s.length;o++){var r=s[o],n=this.getNiceName(r);e.append(t("<li></li>").append(t("<a></a>").attr("href","#"+r.id).attr("data-text",n).text(n).addClass("ws_actor_option"))),i=r.id===this.selectedActor||i}if(this.isProVersion){var l="Choose usersâ€¦";e.append(t("<li>").append(t("<a></a>").attr("id","ws_show_more_users").attr("href","#more-users").attr("data-text",l).text(l)))}this.isProVersion&&e.show(),null===this.selectedActor||i||this.setSelectedActor(null),this.highlightSelectedActor()},e.prototype.getVisibleActors=function(){var t=this;if(this.cachedVisibleActors)return this.cachedVisibleActors;var i=e._,s=[];return i.forEach(this.actorManager.getRoles(),function(e){s.push(e)}),this.actorManager.getUser(this.currentUserLogin).isSuperAdmin&&s.push(this.actorManager.getSuperAdmin()),s.push(this.actorManager.getUser(this.currentUserLogin)),i(this.visibleUsers).without(this.currentUserLogin).sortBy().forEach(function(e){var i=t.actorManager.getUser(e);s.push(i)}).value(),this.cachedVisibleActors=s,s},e.prototype.saveVisibleUsers=function(){jQuery.post(this.ajaxParams.adminAjaxUrl,{action:this.ajaxParams.ajaxUpdateAction,_ajax_nonce:this.ajaxParams.ajaxUpdateNonce,visible_users:jQuery.toJSON(this.visibleUsers)})},e.prototype.getCurrentUserActor=function(){return this.actorManager.getUser(this.currentUserLogin)},e.prototype.getNiceName=function(e){var t=e.displayName;return e instanceof AmeUser&&(t=e.userLogin===this.currentUserLogin?"Current user ("+e.userLogin+")":e.displayName+" ("+e.userLogin+")"),t},e._=wsAmeLodash,e}();